"use strict";(self.webpackChunkwp_node=self.webpackChunkwp_node||[]).push([[694],{77:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"concepts-features/query-util","title":"Query Builder Components","description":"WP-Node heavily relies on Knex.js for querying WordPress database. While Knex.js already provides many built-in helpers, WP-Node extends its functionality by offering specialized Query Builder components for each WordPress table, making it easier and more type-safe to work with.","source":"@site/docs/concepts-features/query-util.md","sourceDirName":"concepts-features","slug":"/concepts-features/query-util","permalink":"/wp-node/docs/concepts-features/query-util","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"User, Role and Capabilities","permalink":"/wp-node/docs/concepts-features/user-role-capabilities"},"next":{"title":"Basic Usage","permalink":"/wp-node/docs/cli/basic-usage"}}');var t=n(4848),i=n(8453);const o={},l="Query Builder Components",c={},d=[{value:"Using QueryUtil",id:"using-queryutil",level:2},{value:"Available Builders",id:"available-builders",level:2},{value:"<code>builder</code> Property",id:"builder-property",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"query-builder-components",children:"Query Builder Components"})}),"\n",(0,t.jsxs)(s.p,{children:["WP-Node heavily relies on ",(0,t.jsx)(s.a,{href:"https://knexjs.org/",children:(0,t.jsx)(s.strong,{children:"Knex.js"})})," for querying WordPress database. While Knex.js already provides many built-in helpers, WP-Node extends its functionality by offering specialized ",(0,t.jsx)(s.strong,{children:"Query Builder components"})," for each WordPress table, making it easier and more type-safe to work with."]}),"\n",(0,t.jsx)(s.h2,{id:"using-queryutil",children:"Using QueryUtil"}),"\n",(0,t.jsxs)(s.p,{children:["When WP-Node initializes a new ",(0,t.jsx)(s.code,{children:"Context"}),", you gain access to ",(0,t.jsx)(s.code,{children:"QueryUtil"})," component via ",(0,t.jsx)(s.code,{children:"context.utils.query"}),". This utility provides access to a set of builders for common WordPress tables."]}),"\n",(0,t.jsx)(s.p,{children:"Example Usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:'const context = await Application.getContext();\nconst queryUtil = context.utils.query;\n\n// Querying posts with post_type = "post", excluding post_status = "draft"\nconst posts = await queryUtil.posts((query) => {\n  query.where("post_type", "post").andWhereNot((query) => {\n    query.where("post_status", "draft");\n  });\n\n  // View the raw SQL query (for debugging)\n  console.log(query.builder.toString());\n});\n'})}),"\n",(0,t.jsx)(s.p,{children:"Each builder method accepts a callback that receives QueryBuilder instance, allowing you to construct complex queries fluently."}),"\n",(0,t.jsx)(s.h2,{id:"available-builders",children:"Available Builders"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"context.utils.query"})," object exposes the following query builder components, each corresponding to a WordPress database table:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"comments"})," \u2192 ",(0,t.jsx)(s.code,{children:"wp_comments"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"meta"})," \u2192 ",(0,t.jsx)(s.code,{children:"wp_postmeta"}),", ",(0,t.jsx)(s.code,{children:"wp_usermeta"}),", etc."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"posts"})," \u2192 ",(0,t.jsx)(s.code,{children:"wp_posts"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"site"})," \u2192 multisite table access"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"terms"})," \u2192 ",(0,t.jsx)(s.code,{children:"wp_terms"}),", ",(0,t.jsx)(s.code,{children:"wp_term_taxonomy"}),", etc."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"users"})," \u2192 ",(0,t.jsx)(s.code,{children:"wp_users"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Each component provides custom helpers on top of Knex.js, tailored to its respective table schema."}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["\ud83d\udcd8 Tip: Explore ",(0,t.jsx)(s.a,{href:"https://github.com/rnaga/wp-node/tree/main/packages/core/src/query-builder",children:(0,t.jsx)(s.code,{children:"query-builder"})})," directory to learn more about available builder methods and utilities."]}),"\n"]}),"\n",(0,t.jsxs)(s.h2,{id:"builder-property",children:[(0,t.jsx)(s.code,{children:"builder"})," Property"]}),"\n",(0,t.jsxs)(s.p,{children:["Every builder instance exposes a .builder property that returns the underlying Knex.js query builder object. This gives you full access to ",(0,t.jsx)(s.a,{href:"https://knexjs.org/guide/query-builder.html",children:"Knex\u2019s query methods"}),", enabling things like:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:'const context = await Application.getContext();\nconst queryUtil = context.utils.query;\n\nconst posts = await queryUtil.posts((query) => {\n  query.where("post_status", "publish");\n  query.builder.limit(5).orderBy("post_date", "desc");\n});\n'})}),"\n",(0,t.jsx)(s.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"QueryUtil is the entry point for database access in WP-Node."}),"\n",(0,t.jsx)(s.li,{children:"Each builder maps to a WordPress table and provides fluent query construction."}),"\n",(0,t.jsx)(s.li,{children:"You can mix WP-Node helpers and raw Knex methods through the .builder accessor."}),"\n",(0,t.jsxs)(s.li,{children:["All query components are available under ",(0,t.jsx)(s.code,{children:"context.utils.query"}),"."]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var r=n(6540);const t={},i=r.createContext(t);function o(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);
"use strict";(self.webpackChunkwp_node=self.webpackChunkwp_node||[]).push([[949],{7592:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"reference/context","title":"Context","description":"Context class is the central runtime component in WP-Node. It initializes and manages core components such as configuration, roles, hooks, current user, and utilities.","source":"@site/docs/reference/context.md","sourceDirName":"reference","slug":"/reference/context","permalink":"/wp-node/docs/reference/context","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Application","permalink":"/wp-node/docs/reference/application"},"next":{"title":"Current","permalink":"/wp-node/docs/reference/current"}}');var s=t(4848),r=t(8453);const o={},l="Context",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Properties",id:"properties",level:2},{value:"Methods",id:"methods",level:2},{value:"<code>getInstance(config, { env, hooks, installing? })</code>",id:"getinstanceconfig--env-hooks-installing-",level:5},{value:"<code>clone()</code>",id:"clone",level:5},{value:"Multisite Behavior",id:"multisite-behavior",level:4},{value:"Error Handling",id:"error-handling",level:4}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h4:"h4",h5:"h5",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"context",children:"Context"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/rnaga/wp-node/blob/main/packages/core/src/core/context.ts",children:(0,s.jsx)(n.code,{children:"Context"})})," class is the central runtime component in WP-Node. It initializes and manages core components such as configuration, roles, hooks, current user, and utilities."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Dependency Management"}),": Uses the ",(0,s.jsx)(n.code,{children:"Components"})," system for resolving internal services."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User & Role Setup"}),": Handles role assignment and anonymous user initialization."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multisite Support"}),": Switches blog/site context automatically when multisite is enabled."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Environment-aware"}),": Accepts ",(0,s.jsx)(n.code,{children:"env"})," flag to isolate or differentiate application contexts."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cloneable"}),": Can be duplicated via the ",(0,s.jsx)(n.code,{children:"clone()"})," method for isolated operations."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"config"}),": Instance of the configuration passed to the context."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"hooks"}),": Instance of registered hook handlers (filter/action)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"current"}),": Handles the current user and site state."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"roles"}),", ",(0,s.jsx)(n.code,{children:"utils"}),", ",(0,s.jsx)(n.code,{children:"vars"}),", ",(0,s.jsx)(n.code,{children:"options"}),", ",(0,s.jsx)(n.code,{children:"logger"}),": Pre-wired internal modules."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"env"}),": Returns the current environment (e.g. ",(0,s.jsx)(n.code,{children:'"local"'}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(n.h5,{id:"getinstanceconfig--env-hooks-installing-",children:(0,s.jsx)(n.code,{children:"getInstance(config, { env, hooks, installing? })"})}),"\n",(0,s.jsxs)(n.p,{children:["Creates and fully initializes a new ",(0,s.jsx)(n.code,{children:"Context"})," instance. Sets up the current site/user and fires the ",(0,s.jsx)(n.code,{children:"core_init"})," hook."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": This method is typically not called directly. Use ",(0,s.jsx)(n.code,{children:"Application.getContext(env)"})," instead, which handles the proper initialization and configuration setup."]}),"\n"]}),"\n",(0,s.jsx)(n.h5,{id:"clone",children:(0,s.jsx)(n.code,{children:"clone()"})}),"\n",(0,s.jsx)(n.p,{children:"Creates a fresh copy of the context with the same environment and configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const cloned = await context.clone();\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"multisite-behavior",children:"Multisite Behavior"}),"\n",(0,s.jsxs)(n.p,{children:["If multisite is enabled, ",(0,s.jsx)(n.code,{children:"getInstance"})," will automatically switch to the configured default site and blog ID:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"if (config.multisite.enabled) {\n  await context.current.switchSite(\n    config.multisite.defaultSiteId,\n    config.multisite.defaultBlogId\n  );\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"If not, it simply sets default user roles."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsxs)(n.p,{children:["During ",(0,s.jsx)(n.code,{children:"getInstance()"}),", errors in role resolution are handled gracefully\u2014especially during installation. Default roles are applied when needed:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"context.current.setDefaultUserRoles();\n"})}),"\n",(0,s.jsx)(n.p,{children:"To avoid install-time crashes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'if (!installing) {\n  console.warn("Failed to initialize the Current component.", e);\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var i=t(6540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkwp_node=self.webpackChunkwp_node||[]).push([[17],{7209:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"cli/custom-cli","title":"Developing Custom CLI","description":"You can build your own CLI commands using WP-Node CLI. This guide walks you through creating a custom CLI that lists posts with post_type = \\"page\\".","source":"@site/docs/cli/custom-cli.md","sourceDirName":"cli","slug":"/cli/custom-cli","permalink":"/wp-node/docs/cli/custom-cli","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"REPL CLI","permalink":"/wp-node/docs/cli/repl-cli"},"next":{"title":"Reference","permalink":"/wp-node/docs/reference/intro"}}');var i=t(4848),o=t(8453);const a={},r="Developing Custom CLI",c={},l=[{value:"Initialize a WP-Node Project",id:"initialize-a-wp-node-project",level:2},{value:"Install CLI Package",id:"install-cli-package",level:3},{value:"Create a Custom CLI Command",id:"create-a-custom-cli-command",level:2},{value:"Register Your CLI",id:"register-your-cli",level:2},{value:"Project File Structure",id:"project-file-structure",level:2},{value:"Run the Custom CLI",id:"run-the-custom-cli",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"developing-custom-cli",children:"Developing Custom CLI"})}),"\n",(0,i.jsx)(n.p,{children:'You can build your own CLI commands using WP-Node CLI. This guide walks you through creating a custom CLI that lists posts with post_type = "page".'}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\ud83d\udcd6 ",(0,i.jsx)(n.strong,{children:"Source Code"}),": For a complete working example, see the ",(0,i.jsx)(n.a,{href:"https://github.com/rnaga/wp-node/tree/main/examples/custom-cli",children:"custom-cli example"})," in the repository."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"initialize-a-wp-node-project",children:"Initialize a WP-Node Project"}),"\n",(0,i.jsx)(n.p,{children:"First, scaffold your WP-Node project:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"npx @rnaga/wp-node-cli -- init\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["For details, see the ",(0,i.jsx)(n.a,{href:"../getting-started/installation#initialize-wp-node-project",children:"Installation Guide"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"install-cli-package",children:"Install CLI Package"}),"\n",(0,i.jsx)(n.p,{children:"Install WP-Node CLI package into your project:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"npm i -S @rnaga/wp-node-cli\n"})}),"\n",(0,i.jsx)(n.h2,{id:"create-a-custom-cli-command",children:"Create a Custom CLI Command"}),"\n",(0,i.jsxs)(n.p,{children:["Create a new file called ",(0,i.jsx)(n.code,{children:"list-pages.cli.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { Command } from "commander";\n\nimport Application from "@rnaga/wp-node/application";\nimport { command, subcommand } from "@rnaga/wp-node-cli/decorators";\nimport { Cli } from "@rnaga/wp-node-cli/cli";\n\n@command("page", { description: "Page commands", version: "1.0.0" })\nexport class PageCli extends Cli {\n  @subcommand("list", { description: "List pages" })\n  async list(program: Command) {\n    program\n      .option("-P --perpage <perpage>", "Pages per page")\n      .option("-S --search <search>", "Search for pages");\n\n    await this.settings({ program });\n\n    const context = await Application.getContext();\n    await context.current.assumeUser(this.assumedUserId);\n\n    const result = await context.utils.crud.post.list(\n      {\n        per_page: this.options.perpage,\n        search: this.options.search,\n      },\n      {\n        postTypes: ["page"],\n      }\n    );\n\n    if (!result.data.length) {\n      this.output("error", "Pages not found");\n      return;\n    }\n\n    this.output("info", {\n      message: `Pages found - count: ${result.info.pagination.count}`,\n      data: result.data,\n    });\n\n    return result;\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"register-your-cli",children:"Register Your CLI"}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"index.ts"})," to register your new CLI to Clis"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import "./_wp/settings";\nimport { Clis } from "@rnaga/wp-node-cli/clis";\n\nimport { PageCli } from "./list-pages.cli";\n\n(async () => {\n  Clis.register([PageCli]);\n  await Clis.executeCommand(process.argv);\n})();\n'})}),"\n",(0,i.jsx)(n.h2,{id:"project-file-structure",children:"Project File Structure"}),"\n",(0,i.jsx)(n.p,{children:"Your project should look like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:".\n\u251c\u2500\u2500 _wp\n\u2502   \u251c\u2500\u2500 config\n\u2502   \u2502   \u251c\u2500\u2500 index.d.ts\n\u2502   \u2502   \u2514\u2500\u2500 wp.json\n\u2502   \u2514\u2500\u2500 settings.ts\n\u251c\u2500\u2500 .env\n\u251c\u2500\u2500 index.ts                 # Updated to run CLI\n\u251c\u2500\u2500 list-pages.cli.ts       # Your custom CLI file\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 package-lock.json\n\u2514\u2500\u2500 tsconfig.json\n"})}),"\n",(0,i.jsx)(n.h3,{id:"run-the-custom-cli",children:"Run the Custom CLI"}),"\n",(0,i.jsx)(n.p,{children:"Check that the new command is available:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"npx ts-node ./index.ts -- page -h\n"})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Usage: page <subcommand> [options]\n\nSubcommands:\n   list             List pages\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run the actual command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"npx ts-node ./index.ts -- page list -P 1 -Z table -F ID,post_title\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 (index) \u2502 ID \u2502 post_title    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 2  \u2502 'Sample Page' \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);